<div class="bg-gray-100 min-h-screen py-8">
  <div class="container mx-auto max-w-4xl px-4">
    <%= form_with(model: @order, url: checkouts_path, local: true, data: { turbo: false }) do |f| %>
      <%# Hidden field para manter o product_id se for compra direta %>
      <%= hidden_field_tag :product_id, params[:product_id] %>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        
        <%# Lado Esquerdo: Formulários %>
        <div class="md:col-span-2 space-y-4">
          
          <%# 1. Endereço %>
          <div class="bg-white p-6 shadow-sm rounded border border-gray-200">
            <h2 class="text-xl font-bold mb-4 text-gray-800">1. Endereço de Envio</h2>
            <div class="space-y-3">
              <%= f.text_field :street, placeholder: "Rua e Número", required: true, class: "p-2 border rounded w-full outline-none focus:ring-1 focus:ring-orange-500" %>
              <div class="grid grid-cols-2 gap-2">
                <%= f.text_field :city, placeholder: "Cidade", required: true, class: "p-2 border rounded outline-none focus:ring-1 focus:ring-orange-500" %>
                <%= f.text_field :state, placeholder: "Estado", required: true, class: "p-2 border rounded outline-none focus:ring-1 focus:ring-orange-500" %>
              </div>
              <%= f.text_field :zip_code, placeholder: "CEP", required: true, class: "p-2 border rounded w-full outline-none focus:ring-1 focus:ring-orange-500" %>
            </div>
          </div>

          <%# 2. Pagamento %>
          <div class="bg-white p-6 shadow-sm rounded border border-gray-200">
            <h2 class="text-xl font-bold mb-4 text-orange-700">2. Método de Pagamento</h2>
            <div class="space-y-3">
              <input type="text" placeholder="Nome no Cartão" required class="p-2 border rounded w-full outline-none focus:ring-1 focus:ring-orange-500">
              
              <%# Máscara 16 dígitos %>
              <input type="text" id="card-number" placeholder="0000 0000 0000 0000" maxlength="19" required class="p-2 border rounded w-full outline-none focus:ring-1 focus:ring-orange-500">
              
              <div class="grid grid-cols-2 gap-2">
                <%# Máscara Validade %>
                <input type="text" id="card-expiry" placeholder="MM/AA" maxlength="5" required class="p-2 border rounded outline-none focus:ring-1 focus:ring-orange-500">
                
                <%# Máscara CVV %>
                <input type="text" id="card-cvv" placeholder="CVV" maxlength="3" required class="p-2 border rounded outline-none focus:ring-1 focus:ring-orange-500">
              </div>
            </div>
          </div>
        </div>

        <%# Lado Direito: Resumo de Preço e Botão Final %>
        <div class="bg-white p-6 shadow-sm rounded h-fit border-2 border-orange-200">
          <h2 class="text-lg font-bold mb-4 text-gray-800">Resumo do Pedido</h2>
          
          <div class="flex justify-between mb-4 font-bold text-red-700 text-xl border-t pt-4">
            <span>Total:</span>
            <span>R$ <%= number_with_precision(@total, precision: 2) %></span>
          </div>

          <%= f.submit "Finalizar Compra", class: "w-full bg-[#ffd814] hover:bg-[#f7ca00] py-3 rounded-lg shadow-md cursor-pointer font-bold border border-[#fcd200] transition-colors" %>
          
          <div class="mt-4 p-2 bg-gray-50 rounded text-[10px] text-gray-500 text-center">
            Ao confirmar a compra, você aceita as Condições de Uso da Amazon Pro.
          </div>
        </div>

      </div>
    <% end %>
  </div>
</div>

<script>
  // Script para as máscaras de cartão de crédito
  document.addEventListener('turbo:load', () => {
    const cardNum = document.getElementById('card-number');
    const cardExp = document.getElementById('card-expiry');
    const cardCvv = document.getElementById('card-cvv');

    if(cardNum) {
      cardNum.addEventListener('input', (e) => {
        let v = e.target.value.replace(/\D/g, '');
        v = v.match(/.{1,4}/g)?.join(' ') || v;
        e.target.value = v;
      });
    }

    if(cardExp) {
      cardExp.addEventListener('input', (e) => {
        let v = e.target.value.replace(/\D/g, '');
        if (v.length > 2) v = v.substring(0,2) + '/' + v.substring(2,4);
        e.target.value = v;
      });
    }

    if(cardCvv) {
      cardCvv.addEventListener('input', (e) => {
        e.target.value = e.target.value.replace(/\D/g, '');
      });
    }
  });
</script>
