<!DOCTYPE html>
<html>
  <head>
    <title>Amazon Clone</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="bg-gray-100 flex flex-col min-h-screen">
    <% unless controller_name == 'checkouts' %>
      <header class="bg-[#131921] text-white py-2 px-4 sticky top-0 z-50">
        <div class="container mx-auto flex items-center justify-between gap-4">
          <%= link_to root_path, class: "flex items-center border border-transparent hover:border-white p-1" do %>
            <span class="text-2xl font-bold italic">amazon<span class="text-orange-400">clone</span></span>
          <% end %>

          <%# Barra de Busca Funcional %>
          <%= form_with url: root_path,
                        method: :get,
                        id: "search-form",
                        class: "hidden md:flex flex-grow max-w-2xl",
                        local: true do |f| %>
          
            <%= f.text_field :query,
                  value: params[:query],
                  class: "w-full p-2 rounded-l text-black outline-none",
                  placeholder: "Buscar na Amazon Pro" %>
          
            <button type="submit"
                    id="search-button"
                    class="bg-[#febd69] hover:bg-[#f3a847] px-5 rounded-r text-black cursor-pointer">
              üîç
            </button>
          <% end %>


          <div class="flex items-center gap-4 text-sm">
            <div class="border border-transparent hover:border-white p-1">
              <% if user_signed_in? %>
                <p>Ol√°, <%= current_user.email.split('@')[0] %></p>
                <%= link_to "Sair", destroy_user_session_path, data: { turbo_method: :delete }, class: "font-bold" %>
              <% else %>
                <%= link_to "Ol√°, fa√ßa seu login", new_user_session_path, class: "font-bold" %>
              <% end %>
            </div>

            <%= link_to orders_path, class: "font-bold border border-transparent hover:border-white p-1" do %>Pedidos<% end %>

            <%= link_to cart_path, class: "flex items-center border border-transparent hover:border-white p-1" do %>
              <div class="relative">
                <span class="text-2xl">üõí</span>
                <span class="absolute -top-1 -right-1 bg-orange-500 text-black rounded-full text-xs w-4 h-4 flex items-center justify-center font-bold">
                  <%= session[:cart].present? ? session[:cart].keys.count : 0 %>
                </span>
              </div>
              <span class="font-bold ml-1 hidden md:inline">Carrinho</span>
            <% end %>
          </div>
        </div>
      </header>
    <% end %>

    <main class="flex-grow"><%= yield %></main>

    <% unless controller_name == 'checkouts' %>
      <footer class="bg-[#232f3e] text-white mt-auto">
        <div class="container mx-auto py-10 px-4 grid grid-cols-2 md:grid-cols-4 gap-8">
          <div><h4 class="font-bold mb-3">Conhe√ßa-nos</h4><ul class="text-sm space-y-2 text-gray-300"><li>Informa√ß√µes</li><li>Carreiras</li></ul></div>
          <div><h4 class="font-bold mb-3">Pagamento</h4><ul class="text-sm space-y-2 text-gray-300"><li>Cart√µes</li><li>Pix</li></ul></div>
        </div>
        <div class="py-8 text-center text-xs text-gray-400 border-t border-gray-700">
          <p>¬© 2026 Amazon Clone - jardeltbezerraf on github</p>
        </div>
      </footer>
    <% end %>
  </body>
</html>
